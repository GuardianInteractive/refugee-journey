!function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),a.Mustache=c}}(this,function(a){function b(a,b){return t.call(a,b)}function c(a){return!b(p,a)}function d(a){return"function"==typeof a}function e(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return w[a]})}function g(a){if(!v(a)||2!==a.length)throw new Error("Invalid tags: "+a);return[new RegExp(e(a[0])+"\\s*"),new RegExp("\\s*"+e(a[1]))]}function h(b,d){function f(){if(A&&!B)for(;z.length;)delete y[z.pop()];else z=[];A=!1,B=!1}d=d||a.tags,b=b||"","string"==typeof d&&(d=d.split(o));for(var h,l,m,p,t,u,v=g(d),w=new k(b),x=[],y=[],z=[],A=!1,B=!1;!w.eos();){if(h=w.pos,m=w.scanUntil(v[0]))for(var C=0,D=m.length;D>C;++C)p=m.charAt(C),c(p)?z.push(y.length):B=!0,y.push(["text",p,h,h+1]),h+=1,"\n"===p&&f();if(!w.scan(v[0]))break;if(A=!0,l=w.scan(s)||"name",w.scan(n),"="===l?(m=w.scanUntil(q),w.scan(q),w.scanUntil(v[1])):"{"===l?(m=w.scanUntil(new RegExp("\\s*"+e("}"+d[1]))),w.scan(r),w.scanUntil(v[1]),l="&"):m=w.scanUntil(v[1]),!w.scan(v[1]))throw new Error("Unclosed tag at "+w.pos);if(t=[l,m,h,w.pos],y.push(t),"#"===l||"^"===l)x.push(t);else if("/"===l){if(u=x.pop(),!u)throw new Error('Unopened section "'+m+'" at '+h);if(u[1]!==m)throw new Error('Unclosed section "'+u[1]+'" at '+h)}else"name"===l||"{"===l||"&"===l?B=!0:"="===l&&(v=g(d=m.split(o)))}if(u=x.pop())throw new Error('Unclosed section "'+u[1]+'" at '+w.pos);return j(i(y))}function i(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function j(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;h>g;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function k(a){this.string=a,this.tail=a,this.pos=0}function l(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function m(){this.cache={}}var n=/\s*/,o=/\s+/,p=/\S/,q=/\s*=/,r=/\s*\}/,s=/#|\^|\/|>|\{|&|=|!/,t=RegExp.prototype.test,u=Object.prototype.toString,v=Array.isArray||function(a){return"[object Array]"===u.call(a)},w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};k.prototype.eos=function(){return""===this.tail},k.prototype.scan=function(a){var b=this.tail.match(a);if(b&&0===b.index){var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c}return""},k.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},l.prototype.push=function(a){return new l(a,this)},l.prototype.lookup=function(a){var b;if(a in this.cache)b=this.cache[a];else{for(var c=this;c;){if(a.indexOf(".")>0){b=c.view;for(var e=a.split("."),f=0;null!=b&&f<e.length;)b=b[e[f++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this.cache[a]=b}return d(b)&&(b=b.call(this.view)),b},m.prototype.clearCache=function(){this.cache={}},m.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=h(a,b)),d},m.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof l?b:new l(b);return this.renderTokens(d,e,c,a)},m.prototype.renderTokens=function(b,c,e,f){function g(a){return k.render(a,c,e)}for(var h,i,j="",k=this,l=0,m=b.length;m>l;++l)switch(h=b[l],h[0]){case"#":if(i=c.lookup(h[1]),!i)continue;if(v(i))for(var n=0,o=i.length;o>n;++n)j+=this.renderTokens(h[4],c.push(i[n]),e,f);else if("object"==typeof i||"string"==typeof i)j+=this.renderTokens(h[4],c.push(i),e,f);else if(d(i)){if("string"!=typeof f)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,f.slice(h[3],h[5]),g),null!=i&&(j+=i)}else j+=this.renderTokens(h[4],c,e,f);break;case"^":i=c.lookup(h[1]),(!i||v(i)&&0===i.length)&&(j+=this.renderTokens(h[4],c,e,f));break;case">":if(!e)continue;i=this.parse(d(e)?e(h[1]):e[h[1]]),null!=i&&(j+=this.renderTokens(i,c,e,f));break;case"&":i=c.lookup(h[1]),null!=i&&(j+=i);break;case"name":i=c.lookup(h[1]),null!=i&&(j+=a.escape(i));break;case"text":j+=h[1]}return j},a.name="mustache.js",a.version="0.8.0",a.tags=["{{","}}"];var x=new m;a.clearCache=function(){return x.clearCache()},a.parse=function(a,b){return x.parse(a,b)},a.render=function(a,b,c){return x.render(a,b,c)},a.to_html=function(b,c,e,f){var g=a.render(b,c,e);return d(f)?(f(g),void 0):g},a.escape=f,a.Scanner=k,a.Context=l,a.Writer=m});var JOURNEY=JOURNEY||{};JOURNEY.html={base_layout:'<div class="game_wrapper"><div class="status"><p class="cost">Cost: <span class="cost_value"></span></p><p class="days">Cost: <span class="days_value"></span></p></div><div class="scene_container"><div class="scene_content"></div><div class="scene_text"></div></div><div class="control_wrapper"><p class="choice_text"></p><div class="button_container"></div></div></div><div class="testimonies"><h2>The journey</h2><div class="testimony_steps"></div><button class="testimonies_restart_btn">Start again</button><div class="share_links"><a class="twitter_share">Twitter</a><a class="facebook_share">Facebook</a></div></div><div class="debug_output"></div>',passport:'<h2>Passport copy</h2><p>Some more text here</p><p><img width="200" src="http://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Indonesian_passport_data_page.jpg/800px-Indonesian_passport_data_page.jpg" alt="passport" /></p>',start:'<h1>Hello world</h1><p>Some text goes in here.</p><video id="video" controls="" preload="none" poster="http://media.w3.org/2010/05/sintel/poster.png"><source id="mp4" src="http://media.w3.org/2010/05/sintel/trailer.mp4" type="video/mp4"><source id="webm" src="http://media.w3.org/2010/05/sintel/trailer.webm" type="video/webm"><source id="ogv" src="http://media.w3.org/2010/05/sintel/trailer.ogv" type="video/ogg"><p>Your user agent does not support the HTML5 Video element.</p></video>',testimony_airport:'<h2>Something else</h2><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.</p><p><img width="400" src="http://www.wired.com/images_blogs/autopia/images/2009/03/04/arj21.jpg" /></p><p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem.</p><p>Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo.</p><p>Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a,</p>',testimony_flight:'<h2>Flights</h2><p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.</p><p><img width="400" src="http://www.liveforthedrop.com/wp-content/uploads/boat.jpg" /></p><p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem.</p><p>Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo.</p><p>Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a,</p>',view_testimony:'<h1>{{ heading }}</h1><div class="testimony_content">{{{ html }}}</div>',done:"true"};var JOURNEY=JOURNEY||{};JOURNEY.testimonies={start:[JOURNEY.html.testimony_airport,JOURNEY.html.testimony_flight]};var JOURNEY=JOURNEY||{};JOURNEY.assets={start:{img:"http://upload.wikimedia.org/wikipedia/commons/8/81/Waves_lajolla.jpg",html:JOURNEY.html.start},airport:{img:"http://www.sierraexpressmedia.com/wp-content/uploads/2010/11/Lungi-Terminal.jpg",html:""},passport:{img:"http://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Indonesian_passport_first_page_and_inside_cover.jpg/1024px-Indonesian_passport_first_page_and_inside_cover.jpg",html:JOURNEY.html.passport}};var JOURNEY=JOURNEY||{};JOURNEY.data={start:{title:"Your story begins",text:"You are a Syrian refugee",asset:"start",choice:{text:"Land or air?",options:[{text:"Land",destination:"travelByLand"},{text:"Air",destination:"travelByAir"}]}},travelByLand:{title:"Travelling by land",text:"You get to Istanbul. Choose where to go next",days:33,choice:{text:"Greece or Bulgaria?",options:[{text:"Greece",destination:"scene4"},{text:"Bulgaria",destination:"scene5"}]}},buyPassport:{title:"Need a passport",text:"You need a passport. ",asset:"passport",days:33,choice:{text:"Buy a cheap low quality or an expensive high quality passport?",options:[{text:"Cheap and low quality",destination:"cheapPassport"},{text:"Expensive and high quality",destination:"expensivePassport"}]}},cheapPassport:{title:"Buy cheap passport",text:"You purchase a cheap passport.",days:6,cost:300,item:"cheapPassport",choice:{options:[{text:"Continue on",destination:"arriveInGreece"}]}},expensivePassport:{title:"Buy expensive passport",text:"You purchase an expensive passport.",days:9,cost:800,item:"expensivePassport",choice:{options:[{text:"Continue on",destination:"arriveInGreece"}]}},travelByAir:{title:"Travelling by air",text:"You need a false passport.",asset:"airport",days:8,cost:500,choice:{text:"Do you buy a false passort?",options:[{text:"Buy a false passport",destination:"buyPassport"},{text:"Try without a passport",destination:"arriveInGreece"}]}},arriveInGreece:{title:"Arrive in Greece",text:"You arrive in a Greece airport.",days:33,choice:{text:"Airport security want to see your passport.",options:[{text:"Show passport",destination:"showPassport"},{text:"Fess up",destination:"noPassport"}]}},showPassport:{title:"Show passport",text:"You show security your passport",choice:{options:[{text:"Hand over passport",destination:"logic_passport"}]}},logic_passport:{title:"passport logic check",logic:!0,requireItem:"passport",outcomes:{good:{destination:"allowedIn"},bad:{destination:"turnedAway"}}},turnedAway:{title:"Beaten up",text:"You get beaten up",success:!1,end:!0},allowedIn:{title:"You get in",text:"Great! Welcome to your new life",success:!0,end:!0},scene4:{title:"Into Greece",text:"You get beaten up",success:!1,end:!0},scene5:{title:"Into Bulgaria",text:"You get turned back",end:!0},scene6:{title:"You fess up",text:"Great! Welcome to your new life",success:!0,end:!0},scene7:{title:"You keep schtum",text:"Sorry. Back you go",success:!1,choice:{options:[{text:"Next",destination:"scene3"}]}}};var JOURNEY=JOURNEY||{};JOURNEY.Game=function(a){"use strict";function b(){return{dayCount:0,finance:0,childAlive:!0,scenes:[],items:[],success:null}}function c(){z.innerHTML=JOURNEY.html.base_layout,t=$(".game_wrapper",z),m=$(".scene_container",z),n=$(".scene_content",z),o=$(".scene_text",z),q=$(".choice_text",z),s=$(".cost_value",z),u=$(".days_value",z),x=$(".button_container",z),r=$(".debug_output",z),w=$(".testimonies",z),v=$(".testimony_steps"),$(".testimonies_restart_btn").on("click",d),p=document.createElement("button"),p.classList.add("choice_btn")}function d(){y=new b,B="start",t.show(),w.hide(),e()}function e(){var a=A[B];return"start"===B&&(s.text(0),u.text(0),y=new b),a.logic?("passport"===a.requireItem&&(B=!0===g()?a.outcomes.good.destination:a.outcomes.bad.destination),e()):(m.css("background","none"),n.empty(),o.text(a.text),q.text(""),x.empty(),a.asset&&(n.html(JOURNEY.assets[a.asset].html),m.css("background-image","url("+JOURNEY.assets[a.asset].img+")")),a.choice?(a.choice.text&&q.text("> "+a.choice.text),i(a.choice.options)):a.end===!0&&(y.success=a.success,C.push(y),j("Start again","start"),f()),a.item&&y.items.push(a.item),a.days&&a.days>0&&(y.dayCount+=a.days,u.text(y.dayCount),u.addClass("updated")),a.cost&&a.cost>0&&(y.finance+=a.cost,s.text(y.finance),s.addClass("updated")),h(),void 0)}function f(){v.empty(),t.hide(),w.show(),y.scenes.forEach(function(a){var b={heading:JOURNEY.data[a].title,html:""};JOURNEY.testimonies.hasOwnProperty(a)&&JOURNEY.testimonies[a].map(function(a){b.html+=a});var c=Mustache.render(JOURNEY.html.view_testimony,b);v.append(c)})}function g(){return-1!==y.items.indexOf("cheepPassport")?Math.random()<.5:-1!==y.items.indexOf("expensivePassport")?Math.random()<.9:!1}function h(){y.scenes.push(B)}function i(a){a.map(function(a){j(a.text,a.destination)})}function j(a,b){var c=$("<button></button>").text(a);c.on("click",function(){k(b)}),x.append(c)}function k(a){B=a,e()}function l(){c(),d()}var m,n,o,p,q,r,s,t,u,v,w,x,y,z=a,A=JOURNEY.data,B="start",C=[];return l(),this};